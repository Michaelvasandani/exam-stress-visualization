<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JSON Loading Test</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.5;
    }
    h1 {
      color: #333;
      border-bottom: 2px solid #f05454;
      padding-bottom: 10px;
    }
    .card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .success {
      background-color: #e8f5e9;
      border-left: 4px solid #4caf50;
    }
    .error {
      background-color: #ffebee;
      border-left: 4px solid #f44336;
    }
    .warning {
      background-color: #fff3e0;
      border-left: 4px solid #ff9800;
    }
    button {
      background-color: #f05454;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    button:hover {
      background-color: #e04545;
    }
    #results {
      padding: 10px;
      background-color: #f5f5f5;
      border-radius: 4px;
      white-space: pre-wrap;
      font-family: monospace;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    table, th, td {
      border: 1px solid #ddd;
    }
    th, td {
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f5f5f5;
    }
  </style>
</head>
<body>
  <h1>JSON Loading Test</h1>
  
  <div class="card">
    <h2>Test JSON File Loading</h2>
    <p>Click the buttons below to test loading JSON files from different paths:</p>
    
    <div>
      <button onclick="testPath('json/Midterm_1.json')">Test json/Midterm_1.json</button>
      <button onclick="testPath('./json/Midterm_1.json')">Test ./json/Midterm_1.json</button>
      <button onclick="testPath('/json/Midterm_1.json')">Test /json/Midterm_1.json</button>
      <button onclick="testPath('../json/Midterm_1.json')">Test ../json/Midterm_1.json</button>
      <button onclick="testPath('Midterm_1.json')">Test Midterm_1.json</button>
    </div>
  </div>
  
  <div class="card">
    <h2>Loading Results</h2>
    <div id="results">Click a button above to test loading a JSON file...</div>
  </div>
  
  <div class="card">
    <h2>Browser Information</h2>
    <table>
      <tr>
        <th>Property</th>
        <th>Value</th>
      </tr>
      <tr>
        <td>User Agent</td>
        <td id="userAgent"></td>
      </tr>
      <tr>
        <td>Browser</td>
        <td id="browser"></td>
      </tr>
      <tr>
        <td>Current URL</td>
        <td id="currentUrl"></td>
      </tr>
      <tr>
        <td>Page Protocol</td>
        <td id="protocol"></td>
      </tr>
      <tr>
        <td>CORS Support</td>
        <td id="cors"></td>
      </tr>
    </table>
    
    <p id="corsNote" class="warning" style="padding: 10px; display: none;">
      <strong>Note:</strong> You're using the file:// protocol which has strict security restrictions. 
      Loading JSON files may fail due to CORS policies. For proper testing:
      <ul>
        <li>Use a local web server instead of opening files directly</li>
        <li>Try using "Live Server" in VS Code or a similar tool</li>
        <li>Or use Python's built-in server: <code>python -m http.server</code></li>
      </ul>
    </p>
  </div>
  
  <div class="card">
    <h2>Recommended Solutions</h2>
    <ol>
      <li><strong>Use a web server:</strong> Start a local web server in your project directory. This is the most reliable solution.</li>
      <li><strong>Correct folder structure:</strong> Ensure your JSON files are in the correct location (json folder).</li>
      <li><strong>Try alternative loading methods:</strong> Open index.html and use the "Load Sample Data" button if visualizations don't appear.</li>
      <li><strong>Check browser console:</strong> Look for specific error messages that might explain loading failures.</li>
      <li><strong>Check file permissions:</strong> Ensure your JSON files are readable.</li>
    </ol>
    
    <div style="margin-top: 20px;">
      <a href="index.html" style="display: inline-block; background-color: #f05454; color: white; padding: 10px 15px; text-decoration: none; border-radius: 4px;">Return to Dashboard</a>
    </div>
  </div>

  <script>
    // Populate browser information
    document.getElementById('userAgent').textContent = navigator.userAgent;
    document.getElementById('browser').textContent = getBrowserInfo();
    document.getElementById('currentUrl').textContent = window.location.href;
    document.getElementById('protocol').textContent = window.location.protocol;
    
    // Show warning for file:// protocol
    if (window.location.protocol === 'file:') {
      document.getElementById('cors').textContent = "Limited (file:// protocol restrictions apply)";
      document.getElementById('corsNote').style.display = 'block';
    } else {
      document.getElementById('cors').textContent = "Supported (using " + window.location.protocol + ")";
    }
    
    function getBrowserInfo() {
      const ua = navigator.userAgent;
      if (ua.includes('Firefox')) return 'Firefox';
      if (ua.includes('Chrome') && !ua.includes('Edg')) return 'Chrome';
      if (ua.includes('Safari') && !ua.includes('Chrome')) return 'Safari';
      if (ua.includes('Edg')) return 'Edge';
      if (ua.includes('MSIE') || ua.includes('Trident/')) return 'Internet Explorer';
      return 'Unknown';
    }
    
    // Test loading a JSON file from the specified path
    function testPath(path) {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = `Testing ${path}...`;
      resultsDiv.className = '';
      
      // First try a HEAD request to check if the file exists
      fetch(path, { method: 'HEAD' })
        .then(response => {
          if (!response.ok) {
            throw new Error(`File not found (${response.status})`);
          }
          
          resultsDiv.innerHTML += `\nFile exists! Status: ${response.status}\n`;
          
          // Now try to actually load and parse the JSON
          return d3.json(path);
        })
        .then(data => {
          if (!data) {
            throw new Error("Received empty data");
          }
          
          // Successfully loaded JSON
          resultsDiv.innerHTML += `\n✅ SUCCESS: JSON loaded and parsed correctly\n`;
          resultsDiv.innerHTML += `\nData structure: ${getDataStructureSummary(data)}\n`;
          resultsDiv.innerHTML += `\nFirst few entries: ${JSON.stringify(getFirstFewEntries(data), null, 2)}`;
          resultsDiv.className = 'success';
          
          // Add success message
          resultsDiv.innerHTML += `\n\n✨ The path "${path}" works correctly! Use this path in your application.`;
        })
        .catch(error => {
          // Failed to load JSON
          resultsDiv.innerHTML += `\n❌ ERROR: ${error.message}\n`;
          resultsDiv.className = 'error';
        });
    }
    
    // Get a summary of the data structure
    function getDataStructureSummary(data) {
      if (Array.isArray(data)) {
        return `Array with ${data.length} items`;
      }
      
      if (typeof data === 'object' && data !== null) {
        const keys = Object.keys(data);
        
        if (keys.length === 0) {
          return "Empty object {}";
        }
        
        if (keys.includes('S1') || keys.some(k => k.startsWith('S'))) {
          return `Student data object with ${keys.length} students (${keys.join(', ')})`;
        }
        
        return `Object with ${keys.length} keys (${keys.join(', ')})`;
      }
      
      return `Primitive type: ${typeof data}`;
    }
    
    // Get the first few entries of the data for display
    function getFirstFewEntries(data) {
      if (Array.isArray(data)) {
        return data.slice(0, 2);
      }
      
      if (typeof data === 'object' && data !== null) {
        const keys = Object.keys(data);
        
        if (keys.length === 0) {
          return {};
        }
        
        // If it's student data, show the first student and first few metrics
        if (keys.includes('S1') || keys.some(k => k.startsWith('S'))) {
          const firstStudent = data[keys[0]];
          
          if (typeof firstStudent === 'object' && firstStudent !== null) {
            const metricKeys = Object.keys(firstStudent);
            
            if (metricKeys.length > 0) {
              const result = {};
              
              metricKeys.slice(0, 2).forEach(metric => {
                const metricData = firstStudent[metric];
                
                if (Array.isArray(metricData) && metricData.length > 0) {
                  result[metric] = metricData.slice(0, 2);
                } else {
                  result[metric] = metricData;
                }
              });
              
              return { [keys[0]]: result };
            }
          }
        }
        
        // For other object types, just return a subset
        const result = {};
        keys.slice(0, 3).forEach(key => {
          result[key] = data[key];
        });
        
        return result;
      }
      
      return data;
    }
  </script>
</body>
</html> 